# How Amazon CloudWatch Internet Monitor works<a name="CloudWatch-IM-inside-internet-monitor"></a>

This section provides information about how Amazon CloudWatch Internet Monitor works\. This includes descriptions of how AWS collects the data that it uses to help detect connectivity issues across the internet, and how performance and availability scores are calculated\. 

**How AWS measures connectivity issues**  
Amazon CloudWatch Internet Monitor uses internet connectivity data between different AWS Regions and CloudFront points of presence \(POPs\) to different locations through networks or Autonomous System Numbers \(ASNs\), typically internet service providers \(ISPs\)\. This connectivity data is used internally by operators in AWS, on a daily basis, to proactively detect connectivity issues across the global internet\.   
For every AWS Region, we know which portions of the internet communicate with the Region and do the following:  
+ We actively monitor those portions of the internet, with a rolling 30\-day window\.
+ We use both network and higher\-level protocol probes, including both inbound and outbound probing\.

**The AWS advantage**  
Internet Monitor focuses monitoring on just the subset of the internet that's accessed by the users of your AWS resources, instead of broadly monitoring your website from every Region in the world as other tools do\. It’s also a cost effective solution, affordable for large and small companies\.  
Internet Monitor uses the same powerful probes and issue\-detection algorithms that AWS takes advantage of internally and alerts you to connectivity issues that affect your application by creating health events in Internet Monitor\. Internet Monitor then gives you access to the resulting performance and availability map, by overlaying the traffic profile that it creates from your active viewers, based on your application resources\.   
Using this information, Internet Monitor shows you just relevant events \(that is, the events from places where you have active viewers\), and just the impact those events have on your overall viewer volume\. So, how much an impact an event has, percentage\-wise, is based on your total traffic world\-wide\.  
Internet Monitor publishes to CloudWatch Logs internet measurements every five minutes for the top 500 city\-networks \(client locations and ASNs, typically internet service providers or ISPs\) that send traffic to each monitor\. Optionally, you can choose to publish internet measurements for all monitored city\-networks \(up to the 500,000 city\-networks service limit\) to an Amazon S3 bucket\. For more information, see [Publishing internet measurements to Amazon S3 in Amazon CloudWatch Internet Monitor](CloudWatch-IM-get-started.Publish-to-S3.md)\.  
The benefits of Internet Monitor include the following:  
+ Using Internet Monitor doesn't place additional load or cost on your application that's hosted on AWS\.
+ You don't need to include performance measurement code in your client\-side resources, or in your application\.
+ You can get visibility into performance and availability across the internet that your application is connected to, including "last mile" information\.
Note that because Internet Monitor creates measurements based on your AWS resources, Internet Monitor only creates events that are specific to your application traffic\. Global internet issues in general are not reported\. In addition, when the service location is an AWS Region, the measurements and events emitted are designed to represent connectivity at a Regional level and don’t accurately represent connectivity between an end user location and an Availability Zone\. 

**How AWS calculates availability and RTT**  
AWS has active and passive probes that measure the latency \(performance\) at the 90th percentile and reachability \(availability\) from every AWS Region and from the CloudFront service to the entire internet\. Abnormal patterns in connectivity between a service and a customer location is monitored, and then reported as alerts to the customer\.  
Round\-trip time \(RTT\) is how long it takes for a request from the user to return a response to the user\. When round\-trip time is aggregated across end user locations, the value is weighted by the amount of your traffic that is driven by each end user location\.   
As an example, with two end user locations, one serving 90% of traffic with a 5 ms RTT, and the other serving 10% of traffic with a 10 ms RTT, the result is an aggregated RTT of 5\.5 ms \(which comes from 5 ms \* 0\.9 \+ 10 ms \* 0\.1\)\.

**How AWS calculates performance and availability scores**  
AWS has substantial historical data about internet performance and availability between AWS services and different city\-networks \(locations and ASNs\)\. By applying statistical analysis to the data, we can detect when the performance and availability for your application has dropped, compared to an estimated baseline that we’ve calculated\. To make it easier to see those drops, we report that information to you in the form of health scores: a performance score and an availability score\.  
Health scores are calculated at different granularities\. At the finest granularity, we compute the health score for a geographic region, such as a city or a metro area, and an ASN\. We also roll up the individual health scores to global health score numbers for an application in a monitor\. If you view performance or availability scores without filtering for any specific geography or service provider, Internet Monitor provides global health scores\.  
Global health scores span your whole application for the specified time period\. Internet Monitor triggers health events based on global health scores, when the total impact exceeds a specific threshold, 5% impact\. However, when you explore information in the monitor and log files, to investigate issues and learn more, you can filter by specific cities \(locations\), networks \(ASNs or internet service providers\), or both, to see health scores for different end user and service location pairs, depending on the filters that you choose\.  
+ An *availability score* represents the estimated percentage of traffic that is **not** seeing an availability drop\. Internet Monitor estimates the percentage of traffic experiencing a drop from the total traffic seen and availability metrics measurements\. For example, an availability score of 99% for an end user and service location pair is equivalent to 1% of the traffic experiencing an availability drop for that pair\.
+ A *performance score* represents the percentage of traffic that is **not** seeing a performance drop\. For example, a performance score of 99% for an end user and service location pair is equivalent to 1% of the traffic experiencing a performance drop for that pair\.

**AWS calculations for time to first byte \(TTFB\) and latency**  
Time to first byte refers to the time between a browser requesting a page and when it receives the first byte of information from the server\. AWS calculations for TTFB measure the time, including the latency, from Amazon EC2 to the AWS Region or from Amazon CloudFront to the Internet Monitor measurement node \(including the last mile of the node\)\.  
Internet Monitor includes average time to first byte \(TTFB\) information in the **Traffic optimization suggestions** section of the **Traffic insights** tab on the CloudWatch dashboard, to help you evaluate options for different setups for your application that can improve performance\.

**When AWS creates and resolves health events**  
Internet Monitor creates and resolves health events in a monitor based on the global impact that it determines connectivity issues are having on a customer's application\. Internet Monitor calculates the impact of connectivity issues on a client location based on the historical data about internet performance and availability for network traffic that's available to the service through AWS\. It applies the relevant information, based on the geographic locations for ASNs and services that apply to the application for the customer, determined from the resources you added to the monitor\. Then Internet Monitor uses statistical analysis to detect when performance and availability has dropped, creating impact for the customer\.  
Performance and availability scores are represented as the percentage of traffic that is **not** seeing a drop\. Impact is the opposite of this: it's a representation of how much an issue is problematic for a customer's end users\. So if there is a global availability drop of 93%, for example, the corresponding impact would be 7%\.  
When the impact for end user and service location pairs globally for a customer exceeds 5%, this triggers Internet Monitor to generate a health event\. The 5% value is cumulative, so it could mean several smaller events that total 5%, or a single event that goes over the 5% level\.  
 As long as the total is over 5%, the health event stays active\. When the total drops below 5%, the health event is resolved\.

**Health event report timing**  
Internet Monitor uses an aggregator to gather all signals about internet issues, to create health events in monitors within minutes\.  
When possible, Internet Monitor analyzes the origin of a health event, to determine whether it was caused by AWS or an ASN\. Health event analysis continues after an event is resolved\. Internet Monitor can update events with new information for up to an hour\.